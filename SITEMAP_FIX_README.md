# Sitemap Fix for Versioned Documentation

## Problem

The sitemap.xml generated by MkDocs contains URLs without versioning (e.g., `/platform/developer-guide/`), but the actual versioned documentation requires versioned URLs (e.g., `/platform/developer-guide/latest/` or `/platform/developer-guide/1.0/`).

## Solution

We've created a Python script `fix-sitemap.py` that automatically corrects sitemap URLs to include proper versioning after the MkDocs build process.

## Files Added/Modified

1. **`fix-sitemap.py`** - Python script that fixes sitemap URLs
2. **`versioned-build.py`** - Modified to include sitemap fixing step
3. **`SITEMAP_FIX_README.md`** - This documentation

## How It Works

1. **Detection**: The script identifies URLs that need versioning based on predefined patterns:
   - `/marketplace/developer-guide/`
   - `/marketplace/user-guide/`
   - `/platform/developer-guide/`
   - `/platform/user-guide/`
   - `/platform/deployment-on-cloud/`
   - `/storefront/developer-guide/`
   - `/storefront/user-guide/`

2. **Versioning**: URLs are updated to include either:
   - `/latest/` (default, recommended)
   - Specific version like `/1.0/`

3. **Integration**: The fix is automatically applied during the build process in `versioned-build.py`

## Usage

### Manual Usage

```bash
# Fix sitemap with 'latest' version
python3 fix-sitemap.py site/sitemap.xml --use-latest

# Fix sitemap with specific version
python3 fix-sitemap.py site/sitemap.xml 1.0
```

### Automatic Usage

The fix is automatically applied when running the versioned build:

```bash
python3 versioned-build.py
```

## Example

**Before:**
```xml
<url>
    <loc>https://docs.virtocommerce.org/platform/developer-guide/</loc>
    <lastmod>2025-10-22</lastmod>
    <changefreq>daily</changefreq>
</url>
```

**After:**
```xml
<url>
    <loc>https://docs.virtocommerce.org/platform/developer-guide/latest/</loc>
    <lastmod>2025-10-22</lastmod>
    <changefreq>daily</changefreq>
</url>
```

## Benefits

1. **SEO Improvement**: Search engines can properly index versioned documentation
2. **User Experience**: Users get correct URLs when accessing documentation
3. **Automation**: No manual intervention required during build process
4. **Flexibility**: Supports both 'latest' and specific version URLs

## Technical Details

- **Language**: Python 3
- **Dependencies**: xml.etree.ElementTree, urllib.parse, re
- **Input**: sitemap.xml file path
- **Output**: Modified sitemap.xml with versioned URLs
- **Pattern Matching**: Uses regex to identify URLs that need versioning
- **XML Processing**: Preserves XML structure and formatting

## Integration with Build Process

The sitemap fix is integrated as Step 4 in the `versioned-build.py` process:

1. Build non-versioned sites
2. Deploy versioned subsites with Mike
3. Copy versioned content from gh-pages
4. **Fix sitemap.xml URLs for versioning** ‚Üê New step
5. Start Python HTTP server

## Error Handling

- Validates sitemap file existence
- Handles XML parsing errors gracefully
- Provides detailed output of changes made
- Continues build process even if sitemap fix fails (with warning)

## Testing

The solution has been tested and successfully fixes 1150+ URLs in the sitemap, converting them from non-versioned to versioned format.
